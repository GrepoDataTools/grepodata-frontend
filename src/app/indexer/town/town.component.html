<div style="min-height: calc(100vh - 160px);">

	<mat-card class="decorated-card">
		<mat-card-title class='decorated-card-header decorated-title' style="margin-bottom: 0px;">

			<div style="position: absolute; top: 10px; max-width: 200px;">
				<button mat-button class="mat-raised-button bg-gd-2" style="width: 100%; overflow: hidden; text-overflow: ellipsis;" routerLink="/indexer/{{key}}">
					<i class="fa fa-arrow-left"></i> Index: {{key}}
				</button>
			</div>

			<h1>
				Showing collected intel for:
				<i class="fa fa-university gd-secondary" aria-hidden="true"></i>&nbsp;<span>{{townName}}</span>
			</h1>
			<h3>
				&nbsp;&nbsp;&nbsp;Index: <span class='world-title'><a class="a-link-dialog" style="color: #334254 !important;" routerLink="/indexer/{{key}}">{{key}}</a></span>
				World: <span class='world-title gd-secondary'>{{world}}</span>
				Player: <span class='world-title gd-secondary'><a class="a-link-dialog" style="color: #334254 !important;" routerLink="/indexer/player/{{key}}/{{world}}/{{playerId}}">{{playerName}}</a></span>
			</h3>
		</mat-card-title>
		<mat-card-content class="decorated-card-content" style="padding: 0 !important;">

			<div *ngIf="err != ''" class="alert alert-danger text-center">
				{{err}}
			</div>
			<div *ngIf="err == ''">
				<index-search indexKey="{{key}}"></index-search>

				<mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

				<div style="width: calc(100vw - 68px); margin: auto;">
					<app-index-version *ngIf="!noIntel && !loading" version="{{version}}" message="{{message}}" key="{{key}}"></app-index-version>
				</div>

				<div *ngIf="!noIntel && !loading">
					<div>

						<mat-card>
							<mat-card-content>
								<div>
									<div *ngIf="build.length > 0">
										<h3 style='font-weight: 300; color: #304357;'>
											<span class='world-title' style='color: #18BC9C;'>Latest building intelligence</span>
										</h3>
										<span class="build-cell" style="transform: scale(1.4); float: left; margin: 15px;" *ngFor="let building of build" >
                      <div class="building_icon40x40 {{building.name}}" matTooltip="{{building.name}}: {{building.val}} ({{building.date}})">
                        <span class="unit-val">{{building.val}}</span>
                      </div>
                    </span>
										<br/><br/><br/>
									</div>
									<h3 style='font-weight: 300; color: #304357;'>
										<span class='world-title' style='color: #18BC9C;'>Unit intelligence history</span>
									</h3>
									<div class="table intel-table" id="table_all" style="transform: scale(.9);">

										<div class="row_custom header bg-gd-2" >
											<div class="cell">
												Type
											</div>
											<div class="cell">
												Date
											</div>
											<div class="cell">
												Units
											</div>
											<div class="cell">
												Hero
											</div>
											<div class="cell">
												God
											</div>
											<div class="cell">
												Silver
											</div>
											<div class="cell">
												Wall
											</div>
											<div class="cell" *ngIf="csa!=false"></div>
										</div>

										<div class='row_custom' *ngFor="let town of allCities">
											<div class="cell" matTooltip="{{town.type}}">
												<img src="../../assets/images/game/towninfo/attack.png" *ngIf="town.type === 'friendly_attack'">
												<div *ngIf="town.type === 'enemy_attack'" style="-moz-transform: scaleX(-1); -o-transform: scaleX(-1); -webkit-transform: scaleX(-1); transform: scaleX(-1); filter: FlipH; -ms-filter: ;">
													<img src="../../assets/images/game/towninfo/attack.png">
												</div>
												<img src="../../assets/images/game/towninfo/support.png" *ngIf="town.type === 'support'">
												<img src="../../assets/images/game/towninfo/conquer.png" *ngIf="town.type === 'attack_on_conquest'">
												<img src="../../assets/images/game/towninfo/espionage_2.67.png" *ngIf="town.type === 'spy'">
											</div>
											<div class="cell">
												{{town.date | IndexDate}}
											</div>
											<div class="cell" style="display: flex;">
                        <span style="transform: scale(1.15); float: left; margin: 15px;" *ngFor="let unit of town.units | ValuesPipe; let i = index;"
                              matTooltip="{{unit?.name?.replace('_',' ')}}">
                          <div class="unit_icon40x40 {{unit?.name}}"><span class="unit-val">{{unit?.count}}</span></div>
                          <span style="color: #d00;" *ngIf="unit?.killed>0">-{{unit?.killed}}</span>
                        </span>
											</div>
											<div class="cell">
                        <span style="transform: scale(1.15); float: left; margin: 15px;"
                              matTooltip="{{town?.hero?.replace('_',' ')}}">
                          <div class="unit_icon40x40 {{town?.hero}}"></div>
                        </span>
											</div>
											<div class="cell">
												{{town.god}}
											</div>
											<div class="cell">
												{{town.silver}}
											</div>
											<div class="cell">
												<span [outerHTML]="town.wall | HideNoLossPipe"></span>
											</div>
											<div class="cell" style="" *ngIf="csa!=false">
												<button *ngIf="!town.deleted || town?.deleted==false" name="open_bb" class="btn btn-danger" style=""
												        (click)="deleteIntel(town?.id); town.deleted = true;">
													<i class="fa fa-close"></i>&nbsp;Delete
												</button>
												<span *ngIf="town.deleted && town?.deleted==true" title="This record will be deleted within 24 hours.">
													<p style="font-size: 17px; margin: 0;" class="gd-secondary">Marked for deletion</p>
													<button name="open_bb" class="btn btn-primary btn-xs" style="margin-top: -6px;"
													        (click)="deleteIntelUndo(town?.id); town.deleted = false;">
														<i class="fa fa-arrow-left"></i>&nbsp;Undo
													</button>
												</span>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-lg-12 text-center">
										<h4 class="gd-secondary">Game images on this page are subject to Copyright Â© InnoGames GmbH</h4>
									</div>
								</div>
							</mat-card-content>
						</mat-card>
					</div>
				</div>
				<div *ngIf="noIntel && !loading">
					<div class="container">
						<div class="row">
							<br/>
							<br/>
							<div class="alert alert-danger text-center">
								<h3>This index has not yet received any intel on town <strong>{{townName}}</strong></h3>
							</div>
						</div>
					</div>
				</div>

			</div>

		</mat-card-content>
	</mat-card>

</div>